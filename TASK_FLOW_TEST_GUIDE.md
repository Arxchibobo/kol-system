# 任务领取流程测试指南

## 新功能概述

### 1. 任务领取前显示 Task Guide
- **旧流程**: 点击 "Confirm & Claim" → 直接领取任务 → 显示 Task Guide
- **新流程**: 点击 "Confirm & Claim" → 显示 Task Guide → 点击 "I Understand, Start Task" → 领取任务

### 2. 运营端新增任务后的实时通知
- 达人端每 5 秒自动刷新数据
- 检测到新任务后立即显示 "New Tasks Available" 弹窗
- 用户可选择立即查看或稍后查看

## 测试步骤

### 测试 1：任务领取流程

1. **登录达人账号**
   - 打开浏览器，访问系统
   - 使用达人账号登录（如：lucas@myshell.ai）

2. **浏览任务广场**
   - 点击 "Task Market" 标签
   - 查看可用任务列表

3. **查看任务详情**
   - 点击任意任务卡片上的 "View Details" 按钮
   - 验证任务详情模态框正确显示

4. **触发 Task Guide**
   - 在任务详情模态框中点击 "Confirm & Claim" 按钮
   - **预期结果**: 任务详情模态框关闭，Task Guide 弹窗出现
   - **验证内容**:
     - Task Guide 标题显示正确的任务名称
     - 显示 3 个重要提醒（追踪链接、提交内容、质量要求）
     - 显示 "I Understand, Start Task" 按钮

5. **确认领取任务**
   - 点击 "I Understand, Start Task" 按钮
   - **预期结果**:
     - Task Guide 弹窗关闭
     - 任务成功领取
     - 自动跳转到 "My Performance" 页面
     - 新领取的任务出现在列表中

6. **验证任务状态**
   - 在 "My Performance" 页面检查新任务
   - 确认追踪链接已生成
   - 确认任务状态为 "CLAIMED"

### 测试 2：新任务实时通知

1. **准备两个浏览器标签页**
   - 标签页 A：运营端（admin@myshell.ai）
   - 标签页 B：达人端（lucas@myshell.ai）

2. **达人端保持在线**
   - 标签页 B 保持在 Dashboard 或 Task Market 页面
   - 观察控制台日志，确认每 5 秒自动刷新

3. **运营端发布新任务**
   - 切换到标签页 A（运营端）
   - 点击 "Tasks" → "Create Task"
   - 填写任务信息并发布

4. **验证实时通知**
   - 切换回标签页 B（达人端）
   - **预期结果**: 5 秒内（最多）出现 "New Tasks Available" 弹窗
   - **验证内容**:
     - 弹窗显示新任务数量
     - 显示 "View New Tasks" 和 "Later" 按钮

5. **查看新任务**
   - 点击 "View New Tasks" 按钮
   - **预期结果**:
     - 弹窗关闭
     - 自动跳转到 "Task Market" 页面
     - 新任务显示在列表顶部（带有 "NEW" 红色徽章）
     - 用户的 lastSeenTaskTimestamp 已更新

6. **关闭通知**
   - 再次发布新任务
   - 当弹窗出现时，点击 "Later" 按钮
   - **预期结果**: 弹窗关闭，但下次刷新时不会再次显示（除非有更新的任务）

## 边界情况测试

### 测试 3：Task Guide 中途关闭

1. 点击 "Confirm & Claim" 打开 Task Guide
2. 不点击 "I Understand, Start Task"，直接刷新页面
3. **预期结果**: 任务未被领取，仍在 Task Market 中可见

### 测试 4：requirements 为空的任务

1. 运营端创建一个没有 requirements 的任务
2. 达人端查看该任务详情
3. **预期结果**:
   - 任务卡片显示 "0 个任务要求" 或 "0 Requirements"
   - 任务详情模态框中 requirements 部分为空，不会出现错误

### 测试 5：通知设置

1. 进入 "Profile" 页面
2. 找到 "Notification Settings" 部分
3. 取消勾选 "New Task Alerts" 复选框
4. 保存设置
5. 运营端发布新任务
6. **预期结果**: 达人端不会显示新任务通知弹窗

## 性能验证

### 检查点

- [ ] 自动刷新不会导致页面卡顿
- [ ] 控制台日志显示正确的刷新频率（5 秒）
- [ ] 新任务检测逻辑不会重复触发弹窗
- [ ] 所有弹窗的 z-index 层级正确（Task Guide 在最上层）
- [ ] 深色模式下所有弹窗样式正常

## 已知限制

1. **新任务检测延迟**: 最多 5 秒延迟（基于自动刷新间隔）
2. **通知不会持久化**: 如果用户关闭浏览器后再打开，需要等待下一次刷新才能检测到新任务

## 成功标准

✅ 所有测试步骤按预期执行
✅ 无控制台错误或警告
✅ 用户体验流畅，无明显卡顿
✅ 所有文案显示正确（中英文）
✅ 所有弹窗样式在深色和亮色模式下均正常
